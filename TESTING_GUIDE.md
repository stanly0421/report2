# 音樂播放器修正測試指南

## 修正內容概述

本次修正解決了以下問題：

### 1. 播放/暫停按鈕功能修正 ✅
**問題**: 按鈕無法正常工作
**修正**: 
- 改善 `onPlayPauseClicked()` 邏輯
- 當沒有歌曲時顯示適當的錯誤訊息
- 確保播放/暫停狀態正確切換

**測試方法**:
1. 啟動應用程式（沒有歌曲）
2. 點擊播放按鈕 → 應顯示 "播放清單是空的，請先載入音樂檔案"
3. 載入一首歌曲後點擊播放 → 歌曲應開始播放
4. 點擊暫停 → 歌曲應暫停
5. 再次點擊播放 → 歌曲應繼續播放

### 2. 上一首/下一首按鈕功能修正 ✅
**問題**: 按鈕無法使用
**修正**: 
- 確認並保留現有邏輯（原本就是正確的）
- 按鈕在有歌曲時可用

**測試方法**:
1. 載入多首歌曲到播放清單
2. 播放第一首歌
3. 點擊 "下一首" → 應播放第二首歌
4. 點擊 "上一首" → 應播放第一首歌
5. 測試隨機播放模式
6. 測試循環播放模式

### 3. 加入最愛按鈕功能修正 ✅
**問題**: 按鈕無法使用
**修正**: 
- 修正本地檔案的比較邏輯（使用 `filePath` 而不是 `videoId`）
- 添加 `toggleFavoriteForVideo()` 方法以支援從右鍵選單加入最愛
- 確保在播放歌曲時按鈕可用

**測試方法**:
1. 播放一首本地音樂
2. 點擊 "❤️ 加入最愛" 按鈕 → 應顯示 "已加入最愛！"
3. 切換到 "我的最愛" 播放清單 → 應看到剛才加入的歌曲
4. 再次點擊按鈕 → 應顯示 "已從最愛中移除！"
5. 測試右鍵選單的 "❤️ 加入最愛" 選項

### 4. 顯示區域調整 ✅
**問題**: 需要將檔案來源顯示改為字幕顯示
**修正**: 
- 將獨立的字幕顯示區域移除
- 將字幕整合到主顯示區域（videoDisplayArea）
- 更新 HTML 生成函數以包含字幕區塊
- 字幕現在顯示在歌曲資訊下方，有清晰的分隔線

**測試方法**:
1. 播放一首本地音樂
2. 主顯示區域應顯示：
   - 歌曲標題
   - 檔案名稱
   - 字幕區域（標題為 "📝 字幕"）
3. 如果有 Whisper 轉錄，字幕應顯示在字幕區域
4. 點擊字幕中的時間戳連結 → 應跳轉到對應位置

### 5. 歌曲標題更新 ✅
**問題**: 播放時標題仍顯示 "選擇一首歌曲開始播放"
**修正**: 
- `playVideo()` 和 `playLocalFile()` 方法會自動更新標題
- 使用 `updateVideoLabels()` 更新 videoTitleLabel

**測試方法**:
1. 啟動應用程式 → 標題應顯示 "選擇一首歌曲開始播放"
2. 載入並播放一首歌曲 → 標題應變更為歌曲名稱
3. 切換到下一首歌 → 標題應更新為新歌曲名稱

### 6. 播放清單功能增強 ✅
**問題**: 需要更好的播放清單管理功能
**修正**: 
- 添加右鍵選單支援
  - 播放
  - 從播放清單移除
  - 加入最愛
- 載入音樂時自動加入當前播放清單
- 避免重複添加相同檔案
- 保留原有的拖放調整順序功能

**測試方法**:
1. 載入多首音樂 → 每首都應加入播放清單
2. 嘗試載入相同檔案 → 應不會重複添加，但會播放該歌曲
3. 在播放清單項目上點擊右鍵 → 應顯示選單
4. 選擇 "從播放清單移除" → 歌曲應從清單中移除
5. 拖放歌曲調整順序 → 順序應正確更新

## 建置指令

```bash
mkdir -p build
cd build
cmake ..
make
./last-report
```

## 注意事項

1. **Qt 版本**: 需要 Qt5 或 Qt6 with Multimedia 模組
2. **Whisper 支援**: 字幕功能需要 `whisper_transcribe.py` 腳本和 Python 環境
3. **音樂格式**: 支援 mp3, wav, flac, m4a, ogg, aac 等格式

## 已知限制

1. YouTube 影片播放需要在瀏覽器中進行，無法在應用程式內控制
2. Whisper 字幕轉錄是可選功能，如果沒有安裝 Whisper，字幕區域會顯示錯誤訊息但不影響播放

## 回歸測試檢查清單

- [ ] 播放/暫停按鈕正常工作
- [ ] 上一首/下一首按鈕正常工作
- [ ] 加入最愛功能正常工作
- [ ] 字幕顯示在主顯示區域
- [ ] 歌曲標題正確更新
- [ ] 可以從播放清單刪除歌曲
- [ ] 可以拖放調整歌曲順序
- [ ] 載入音樂自動加入播放清單
- [ ] 不會重複添加相同檔案
- [ ] 隨機播放模式正常工作
- [ ] 循環播放模式正常工作
- [ ] 播放清單可以新增/刪除
- [ ] 切換播放清單功能正常
- [ ] 播放清單資料持久化（重啟後恢復）
